# Allow a host to be managed by ansible
# Invoke with something like:
# ansible-playbook /etc/ansible/playbooks/bootstrap.yml --ask-become-pass -e host=<HOSTNAME>

- hosts: "{{ host }}"
  become: true
  become_method: su
  tasks:
    - name: install sudo
      apt:
        name: sudo
        update_cache: yes
        cache_valid_time: 3600
    - name: passwordless sudo config
      copy:
        src: passwordless_sudo
        dest: /etc/sudoers.d/passwordless
    - name: "add {{ primary_user }} to sudo group"
      user:
        name: "{{ primary_user }}"
        append: yes
        groups: sudo
    - name: disable password authentication for ssh
      lineinfile:
        path: /etc/ssh/sshd_config
        line: PasswordAuthentication no
  handlers:
    - name: restart sshd
      service:
        name: sshd
        state: restarted
